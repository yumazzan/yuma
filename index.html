<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ì› íšŒì¥ë‹˜ ì±„ë„ ê¸°íš ëŒ€ì‹œë³´ë“œ (í†µí•©íŒ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for Radar Chart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Serif+KR:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dw-dark: #3D2B24;
            --dw-point: #C9734E;
            --dw-camel: #C28E5B;
            --dw-cream: #E6CF93;
            --dw-sand: #D1B082;
            --dw-bg: #FDFBF7;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--dw-bg);
            color: #2d3748;
        }
        .serif-font { font-family: 'Noto Serif KR', serif; }
        
        .nav-item.active {
            background-color: var(--dw-dark);
            color: var(--dw-cream);
            font-weight: 700;
            border-bottom: 3px solid var(--dw-point);
        }
        .tab-btn.active {
            border-bottom: 3px solid var(--dw-point);
            color: var(--dw-dark);
            font-weight: 700;
            background-color: rgba(230, 207, 147, 0.2);
        }
        
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(61, 43, 36, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid rgba(209, 176, 130, 0.2);
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(61, 43, 36, 0.1);
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--dw-point);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--dw-bg); }
        ::-webkit-scrollbar-thumb { background: var(--dw-camel); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--dw-point); }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header style="background-color: var(--dw-dark);" class="text-white p-6 shadow-xl relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full transform translate-x-1/3 -translate-y-1/3 pointer-events-none"></div>
        
        <div class="container mx-auto flex flex-col md:flex-row items-center relative z-10">
            <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
            <div class="mb-4 md:mb-0 md:mr-6 flex-shrink-0 group relative cursor-pointer" onclick="document.getElementById('profile-upload').click()" title="í´ë¦­í•˜ì—¬ íšŒì¥ë‹˜ ì‚¬ì§„ ë³€ê²½">
                <div class="relative">
                    <img id="profile-image" src="KakaoTalk_Photo_2025-11-26-23-24-24.jpg" alt="ì—„ê·¼ì§„ ë™ì› íšŒì¥ë‹˜" class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 shadow-lg object-cover transition-transform duration-300 group-hover:scale-105" style="border-color: var(--dw-cream);">
                    <div class="absolute inset-0 rounded-full bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                        <span class="text-white text-3xl">ğŸ“·</span>
                    </div>
                    <div class="absolute -bottom-2 -right-2 bg-white text-xs font-bold px-2 py-1 rounded-full shadow border border-gray-200 text-gray-800 z-10 pointer-events-none">
                        íšŒì¥ë‹˜
                    </div>
                </div>
                <input type="file" id="profile-upload" accept="image/*" class="hidden" onchange="updateProfileImage(this)">
            </div>
            
            <div class="flex flex-col md:flex-row justify-between items-center flex-grow">
                <div class="mb-4 md:mb-0 text-center md:text-left">
                    <h1 class="text-3xl font-bold serif-font tracking-wide text-[#FDFBF7]">ğŸ¶ ë™ì› íšŒì¥ë‹˜ ì „ëµê¸°íšì‹¤</h1>
                    <p class="text-sm mt-1 font-light opacity-90" style="color: var(--dw-sand);">"ë‹ˆë“¤ì´ ê°œë§›ì„ ì•Œì•„?" ì‚°ì „ìˆ˜ì „ ë‹¤ ê²ªì€ 11ì‚´ì˜ ìš”ì–‘ ë¼ì´í”„ (with ë™ìƒ)</p>
                </div>
                
                <div class="flex space-x-6 bg-black bg-opacity-20 p-3 rounded-xl backdrop-blur-sm">
                    <div class="text-center px-2">
                        <div class="text-2xl font-bold" style="color: var(--dw-cream);">11ì„¸</div>
                        <div class="text-xs opacity-70">ë‚˜ì´ (ê°œë¥´ì‹ )</div>
                    </div>
                    <div class="w-px bg-white opacity-20"></div>
                    <div class="text-center px-2">
                        <div class="text-2xl font-bold" style="color: var(--dw-cream);">2ì±„</div>
                        <div class="text-xs opacity-70">ë³´ìœ  ë¶€ë™ì‚°</div>
                    </div>
                    <div class="w-px bg-white opacity-20"></div>
                    <div class="text-center px-2">
                        <div class="text-2xl font-bold" style="color: var(--dw-point);">âˆ</div>
                        <div class="text-xs opacity-70">ì—„ê·¼ì§„ë ¥</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50 border-b border-[#E6CF93]">
        <div class="container mx-auto overflow-x-auto">
            <ul class="flex min-w-full md:justify-center text-sm md:text-base whitespace-nowrap">
                <li><button onclick="navigateTo('section-persona')" class="nav-item active px-6 py-4 block hover:bg-orange-50 transition-colors duration-200">ğŸ§ íšŒì¥ë‹˜ í˜ë¥´ì†Œë‚˜</button></li>
                <li><button onclick="navigateTo('section-production')" class="nav-item px-6 py-4 block hover:bg-orange-50 transition-colors duration-200">ğŸ¬ ì œì‘ ê°€ì´ë“œ</button></li>
                <li><button onclick="navigateTo('section-scenarios')" class="nav-item px-6 py-4 block hover:bg-orange-50 transition-colors duration-200">ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ ë³´ë“œ</button></li>
                <li><button onclick="navigateTo('section-strategy')" class="nav-item px-6 py-4 block hover:bg-orange-50 transition-colors duration-200">ğŸš€ ì„±ì¥ ë¡œë“œë§µ</button></li>
                <li><button onclick="navigateTo('section-ai-tools')" class="nav-item px-6 py-4 block hover:bg-orange-50 transition-colors duration-200 font-bold" style="color: var(--dw-point);">âœ¨ AI ë¹„ì„œì‹¤ & ê³µìœ ë°©</button></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 md:p-8 space-y-8">

        <!-- SECTION 2: Persona -->
        <section id="section-persona" class="space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-sm" style="border-left: 5px solid var(--dw-camel);">
                <h2 class="text-2xl font-bold mb-2 serif-font" style="color: var(--dw-dark);">ğŸ§ ì±„ë„ í˜ë¥´ì†Œë‚˜: í”„ë¼ì´ë¹— ì‹¤ë²„íƒ€ìš´</h2>
                <p class="text-gray-600">
                    ë™ì›ì´ëŠ” ë‹¨ìˆœí•œ ê°•ì•„ì§€ê°€ ì•„ë‹™ë‹ˆë‹¤. ì˜†ì§‘(ì‘ì„±ì ì§‘)ì„ ë³¸ì¸ì˜ <strong>'í”„ë¼ì´ë¹— ì‹¤ë²„íƒ€ìš´'</strong>ìœ¼ë¡œ ìƒê°í•˜ëŠ” 11ì‚´ 'ê°œë¥´ì‹ 'ì…ë‹ˆë‹¤.
                </p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Stats Chart -->
                <div class="card p-6">
                    <h3 class="text-lg font-bold mb-4 text-center" style="color: var(--dw-dark);">ğŸ“Š íšŒì¥ë‹˜ ëŠ¥ë ¥ì¹˜ ë¶„ì„</h3>
                    <div class="chart-container">
                        <canvas id="personaChart"></canvas>
                    </div>
                    <p class="text-sm text-center text-gray-500 mt-2">*í™œë™ëŸ‰ì€ ë§¤ìš° ë‚®ìœ¼ë‚˜ ê¶Œìœ„ì™€ ê·€ì°®ìŒì´ ë§Œë ™ì„</p>
                </div>

                <div class="space-y-6">
                    <!-- Voice Settings -->
                    <div class="card p-6 text-white shadow-lg" style="background-color: var(--dw-camel);">
                        <h3 class="text-lg font-bold mb-4 flex items-center">ğŸ™ï¸ AI ë³´ì´ìŠ¤ ì„¤ì •</h3>
                        <div class="space-y-4">
                            <div class="p-3 rounded-lg bg-black bg-opacity-20 border border-white border-opacity-10">
                                <span class="block text-xs uppercase tracking-wider mb-1" style="color: var(--dw-cream);">Concept</span>
                                <div class="font-bold text-lg">"ê°œë¥´ì‹  (ê°œ+ì–´ë¥´ì‹ )"</div>
                            </div>
                            <div class="p-3 rounded-lg bg-black bg-opacity-20 border border-white border-opacity-10">
                                <span class="block text-xs uppercase tracking-wider mb-1" style="color: var(--dw-cream);">Tone</span>
                                <div class="text-gray-100">ì¤‘í›„í•œ ë‹¤íë©˜í„°ë¦¬ ë‚´ë ˆì´ì…˜ ëŠë‚Œ or ì‚¬ê·¹ ì™• í†¤</div>
                            </div>
                            <div class="p-3 rounded-lg bg-black bg-opacity-20 border border-white border-opacity-10">
                                <span class="block text-xs uppercase tracking-wider mb-1" style="color: var(--dw-cream);">Sample Line</span>
                                <div class="italic text-gray-200">"ì™”ëŠ”ê°€. ë¬¼ì´ ë¯¸ì§€ê·¼í•˜ë‹¤. ë¶ˆ ì¢€ êº¼ë¼." (í•˜ì˜¤ì²´/ê·¼ì—„í•œ ë°˜ë§)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Dictionary -->
                    <div class="card p-6">
                        <h3 class="text-lg font-bold mb-4" style="color: var(--dw-dark);">ğŸ“– ìš©ì–´ ì‚¬ì „ (í˜¸ì¹­ ì •ë¦¬)</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="border p-3 rounded" style="border-color: var(--dw-sand);">
                                <span class="block font-bold" style="color: var(--dw-dark);">ë³¸ì¸ (ë™ì›)</span>
                                <span class="text-xl">"ë‚˜"</span>
                                <span class="block text-xs text-gray-400 mt-1">ì„¸ìƒì˜ ì¤‘ì‹¬</span>
                            </div>
                            <div class="border p-3 rounded" style="border-color: var(--dw-sand);">
                                <span class="block font-bold" style="color: var(--dw-dark);">ì‘ì„±ì (ì˜†ì§‘)</span>
                                <span class="text-xl">"ê¹€ë¹„ì„œ"</span>
                                <span class="block text-xs text-gray-400 mt-1">ë³„ì¥ì§€ê¸°, ìë„¤</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Production -->
        <section id="section-production" class="hidden space-y-6">
             <div class="bg-white p-6 rounded-xl shadow-sm" style="border-left: 5px solid var(--dw-point);">
                <h2 class="text-2xl font-bold mb-2 serif-font" style="color: var(--dw-dark);">ğŸ¬ í¸ì§‘ ë° ì—°ì¶œ í¬ì¸íŠ¸</h2>
                <p class="text-gray-600">ë™ì›ì´ì˜ ë¬´í‘œì •ê³¼ ëŠë¦¿í•œ í–‰ë™ì— ë¹ ë¥¸ ë¹„íŠ¸ì˜ í¸ì§‘ì„ ì„ì–´ 'í‚¹ë°›ëŠ”' ì›ƒìŒì„ ìœ ë°œí•©ë‹ˆë‹¤.</p>
            </div>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="card p-6 hover:bg-orange-50 transition-colors">
                    <div class="text-4xl mb-4">ğŸ¥</div>
                    <h3 class="font-bold text-lg mb-2" style="color: var(--dw-dark);">ë¹„ì£¼ì–¼ (í™”ë©´)</h3>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li><strong>ë™ê³µ ì§€ì§„ vs ì •ì§€:</strong> ê²ŒìŠ´ì¸ ë ˆí•œ ëˆˆ, ë© ë•Œë¦¬ëŠ” í‘œì •ì„ ê·¹ë„ë¡œ í™•ëŒ€(Zoom-in).</li>
                    </ul>
                </div>
                <div class="card p-6 hover:bg-orange-50 transition-colors">
                    <div class="text-4xl mb-4">ğŸµ</div>
                    <h3 class="font-bold text-lg mb-2" style="color: var(--dw-dark);">ì˜¤ë””ì˜¤ (BGM)</h3>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li><strong>ë¶€ì¡°í™”ì˜ ë¯¸í•™:</strong> í–‰ë™ì€ ì •ì ì¸ë°, BGMì€ ì›…ì¥í•˜ê±°ë‚˜ ê¸´ë°•í•˜ê²Œ.</li>
                    </ul>
                </div>
                <div class="card p-6 hover:bg-orange-50 transition-colors">
                    <div class="text-4xl mb-4">âœï¸</div>
                    <h3 class="font-bold text-lg mb-2" style="color: var(--dw-dark);">ìë§‰ ìŠ¤íƒ€ì¼</h3>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li><strong>ì§„ì§€í•œ ê¶ì„œì²´:</strong> ë‰´ìŠ¤ ì†ë³´ë‚˜ ë‹¤íë©˜í„°ë¦¬ ìë§‰ ëŠë‚Œ.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 4: Scenarios -->
        <section id="section-scenarios" class="hidden space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-sm" style="border-left: 5px solid var(--dw-sand);">
                <h2 class="text-2xl font-bold mb-2 serif-font" style="color: var(--dw-dark);">ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ ë³´ë“œ (ì—„ê·¼ì§„ ver)</h2>
                <p class="text-gray-600">ë™ì›ì´ê°€ 'ë³„ì¥'ì— ì™€ì„œ ë²Œì–´ì§€ëŠ” 3ê°€ì§€ í•µì‹¬ ìƒí™©ë³„ ëŒ€ë³¸ì…ë‹ˆë‹¤.</p>
            </div>
            <div class="bg-white rounded-xl shadow-lg overflow-hidden min-h-[500px] border" style="border-color: var(--dw-sand);">
                <div class="flex border-b" style="border-color: var(--dw-sand);">
                    <button onclick="showScenario(1)" id="tab-1" class="tab-btn active flex-1 py-4 text-center font-medium hover:bg-orange-50">#1 ì¶œê·¼ (ìš”ì–‘)</button>
                    <button onclick="showScenario(2)" id="tab-2" class="tab-btn flex-1 py-4 text-center font-medium hover:bg-orange-50">#2 ì‚°ì±… ê±°ë¶€</button>
                    <button onclick="showScenario(3)" id="tab-3" class="tab-btn flex-1 py-4 text-center font-medium hover:bg-orange-50">#3 í›ˆìˆ˜ ë‘ê¸°</button>
                </div>
                <div class="p-8 bg-[#FFFCF5]">
                    <div id="scenario-1" class="scenario-content space-y-6">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold serif-font" style="color: var(--dw-dark);">#1. ë³„ì¥ìœ¼ë¡œ ì¶œê·¼í•˜ëŠ” íšŒì¥ë‹˜</h3>
                            <span class="text-white px-3 py-1 rounded-full text-sm" style="background-color: var(--dw-camel);">ìƒí™©: í˜„ê´€ ì…ì¥</span>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="font-bold mb-2" style="color: var(--dw-camel);">ğŸ“¸ í™”ë©´ ì—°ì¶œ</h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-2">
                                    <li>ë¬¸ ì—´ì–´ì£¼ë©´ ê¼¬ë¦¬ë„ ì•ˆ í”ë“¤ê³  ëŠë¦¿ëŠë¦¿ ê±¸ì–´ ë“¤ì–´ì™€ì„œ ìƒì„ ì°©ì„.</li>
                                    <li>ì–¼êµ´ íƒ€ì´íŠ¸í•˜ê²Œ <strong>ì¤Œì¸(Zoom-in).</strong></li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold mb-2" style="color: var(--dw-camel);">ğŸ™ï¸ AI ë‚´ë ˆì´ì…˜ (ì¤‘ì €ìŒ)</h4>
                                <div class="scenario-script p-4 rounded text-lg leading-relaxed serif-font shadow-inner" style="color: var(--dw-dark);">
                                    "ë¬¸ ì—¬ëŠ” ì†ë„ê°€ ëŠ¦ë‹¤, ê¹€ë¹„ì„œ.<br>ë³¸ê°€ëŠ” ì‹œë„ëŸ¬ì›Œì„œ ì‰´ ìˆ˜ê°€ ì—†ì–´.<br>(ì†ŒíŒŒì— ì•‰ìœ¼ë©°) ì—êµ¬êµ¬... í—ˆë¦¬ì•¼...<br>ë³´ì¼ëŸ¬ ì˜¨ë„ê°€ ì ì ˆí•˜êµ°. í•©ê²©ì´ë‹¤.<br>ë°¥ì€ ì°¨ë ¤ë†¨ë‚˜?"
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="scenario-2" class="scenario-content hidden space-y-6">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold serif-font" style="color: var(--dw-dark);">#2. 11ì‚´ì˜ ì²´ë ¥ ë³´ì¡´ ë²•ì¹™</h3>
                            <span class="text-white px-3 py-1 rounded-full text-sm" style="background-color: var(--dw-camel);">ìƒí™©: ì‚°ì±… ê±°ë¶€</span>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="font-bold mb-2" style="color: var(--dw-camel);">ğŸ“¸ í™”ë©´ ì—°ì¶œ</h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-2">
                                    <li>ì‚°ì±… ê°€ìê³  í•˜ë„¤ìŠ¤ ë“¤ë©´ ìëŠ” ì²™í•˜ê±°ë‚˜ í˜„ê´€ì—ì„œ ë²„íŒ€.</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold mb-2" style="color: var(--dw-camel);">ğŸ™ï¸ AI ë‚´ë ˆì´ì…˜ (ê·¼ì—„)</h4>
                                <div class="scenario-script p-4 rounded text-lg leading-relaxed serif-font shadow-inner" style="color: var(--dw-dark);">
                                    "ì´ë´, ì Šì€ì´. ëˆˆì¹˜ê°€ ì—†êµ°.<br>ë‚´ ë‚˜ì´ ì—´í•˜ë‚˜ì•¼. ë„ê°€ë‹ˆ ì•„ê»´ì•¼ í•´.<br>ì‚°ì±…ì€ 'ë§ˆìŒ'ìœ¼ë¡œ í•˜ëŠ” ê±°ë‹¤.<br>ë‚˜ê°€ê³  ì‹¶ìœ¼ë©´ ìë„¤ í˜¼ì ë‹¤ë…€ì˜¤ê²Œ. <br>ì˜¬ ë•Œ ê³ êµ¬ë§ˆ ì‚¬ ì˜¤ê³ ."
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="scenario-3" class="scenario-content hidden space-y-6">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold serif-font" style="color: var(--dw-dark);">#3. í›ˆìˆ˜ ë‘ëŠ” íšŒì¥ë‹˜</h3>
                            <span class="text-white px-3 py-1 rounded-full text-sm" style="background-color: var(--dw-camel);">ìƒí™©: ì‹ì‚¬/ì—…ë¬´ ë°©í•´</span>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="font-bold mb-2" style="color: var(--dw-camel);">ğŸ“¸ í™”ë©´ ì—°ì¶œ</h4>
                                <ul class="list-disc list-inside text-gray-700 space-y-2">
                                    <li>ì‘ì„±ìê°€ ë­ ë¨¹ê±°ë‚˜ ì¼í•  ë•Œ, ì˜†ì—ì„œ í•œì‹¬í•˜ë‹¤ëŠ” í‘œì •ìœ¼ë¡œ ë¹¤íˆ ì³ë‹¤ë´„.</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold mb-2" style="color: var(--dw-camel);">ğŸ™ï¸ AI ë‚´ë ˆì´ì…˜ (í›ˆìˆ˜)</h4>
                                <div class="scenario-script p-4 rounded text-lg leading-relaxed serif-font shadow-inner" style="color: var(--dw-dark);">
                                    "(í˜€ë¥¼ ì°¨ë©°) ì¯§ì¯§... ë°¥ ë¨¹ëŠ” ê¼´í•˜ê³ ëŠ”...<br>ê·¸ë ‡ê²Œ ë¨¹ì–´ì„œ ì–¸ì œ ì‚´ ëº„ë˜?<br>...í•œ ì…ë§Œ ì¤˜ë´. ë§›ì´ë‚˜ ë³´ê²Œ.<br>(ì•ˆ ì£¼ë©´)<br>ë…í•˜ë‹¤ ë…í•´. ë‚´ê°€ ì´ëŸ¬ë ¤ê³  ì—¬ê¸° ì™”ë‚˜ ì‹¶ë‹¤."
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: Strategy -->
        <section id="section-strategy" class="hidden space-y-6">
             <div class="bg-white p-6 rounded-xl shadow-sm" style="border-left: 5px solid var(--dw-point);">
                <h2 class="text-2xl font-bold mb-2 serif-font" style="color: var(--dw-dark);">ğŸš€ í”„ë¡œí•„ ì„¤ì • ë° ìš´ì˜ ì£¼ì˜ì‚¬í•­</h2>
                <p class="text-gray-600">íšŒì¥ë‹˜ì˜ í’ˆê²©ì— ë§ëŠ” í”„ë¡œí•„ ì„¤ì •ê³¼ ë…¸ë ¹ê²¬ì„ ìœ„í•œ ì„¸ì‹¬í•œ ë°°ë ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="font-bold text-lg mb-4" style="color: var(--dw-dark);">ğŸ“ í”„ë¡œí•„ ì†Œê°œ (Bio) ì˜ˆì‹œ</h3>
                    <div class="bg-gray-50 p-4 rounded border border-gray-200 text-sm leading-relaxed text-gray-700">
                        <p class="font-bold mb-2">ë™ì› (11ì„¸ / ë¬´ì§ / ì˜†ì§‘ ê±°ì£¼)</p>
                        <p>"ê²¬ìƒ 11ë…„ ì°¨, ì´ì œ ì›¬ë§Œí•œ ê±´ ì¬ë¯¸ì—†ë‹¤."</p>
                        <p>ğŸ  ë³¸ê°€: ì ë§Œ ìëŠ” ê³³</p>
                        <p>ğŸ¡ ë³„ì¥(ì˜†ì§‘): ìš”ì–‘ ë° ê°‘ì§ˆí•˜ëŠ” ê³³</p>
                        <p>ğŸ“© ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ì˜: ê¹€ë¹„ì„œ(DM)ì—ê²Œ</p>
                    </div>
                </div>
                <div class="card p-6" style="background-color: var(--dw-bg);">
                    <h3 class="font-bold text-lg mb-4" style="color: var(--dw-dark);">ğŸ·ï¸ ì¶”ì²œ í•´ì‹œíƒœê·¸</h3>
                    <div class="bg-white p-4 rounded border mb-4 text-sm break-all" style="border-color: var(--dw-sand); color: var(--dw-camel);" id="hashtag-box">
                        #ê°œë¥´ì‹  #11ì‚´ê°•ì•„ì§€ #ë…¸ê²¬ë§Œì„¸ #íšŒì¥ë‹˜ì˜¤ì…¨ìŠµë‹ˆê¹Œ #ì—„ê·¼ì§„ #ì˜†ì§‘ê°•ì•„ì§€ #ë‚¨ì˜ì§‘ìƒì „ #ì‹œë‹ˆì–´ëª¨ë¸ #ë™ì›ì´ì˜ì´ì¤‘ìƒí™œ #AIë¦´ìŠ¤
                    </div>
                    <button onclick="copyHashtags()" class="w-full text-white py-2 rounded transition shadow-md hover:opacity-90" style="background-color: var(--dw-dark);">
                        ğŸ“‹ í•´ì‹œíƒœê·¸ ë³µì‚¬í•˜ê¸°
                    </button>
                    <p id="copy-msg" class="text-center text-xs text-green-600 mt-2 hidden">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                </div>
            </div>
             <div class="border-l-4 p-6 mt-6 bg-white shadow-md" style="border-color: #ef4444;">
                <div class="flex">
                    <div class="flex-shrink-0 text-2xl">ğŸ¥</div>
                    <div class="ml-4">
                        <h3 class="text-lg font-bold text-red-600">11ì‚´ ë™ì›ì´ë¥¼ ìœ„í•œ íŠ¹ë³„ ì£¼ì˜ì‚¬í•­ (í•„ë…)</h3>
                        <div class="mt-2 text-sm text-gray-700 space-y-2">
                            <p><strong>1. ë¬´ë¦¬í•œ ì—°ì¶œ ê¸ˆì§€ ğŸš«</strong><br>ë…¸ë ¹ê²¬ì´ë¯€ë¡œ ì–µì§€ë¡œ ê¹¨ìš°ê±°ë‚˜, ê±·ê¸° ì‹«ì–´í•˜ëŠ”ë° ëŒê³  ê°€ëŠ” ì˜ìƒì€ ì ˆëŒ€ ê¸ˆë¬¼ì…ë‹ˆë‹¤.</p>
                            <p><strong>2. ê±´ê°• ê°•ì¡° ğŸ’ª</strong><br>11ì‚´ì„ì—ë„ ê±´ê°•í•˜ê²Œ ë‘ ì§‘ì„ ì˜¤ê°€ëŠ” ëª¨ìŠµì„ ë³´ì—¬ì£¼ë©´ í° ê³µê°ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 6: AI Tools & Shared Board -->
        <section id="section-ai-tools" class="hidden space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-sm" style="border-left: 5px solid var(--dw-point);">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold mb-2 serif-font" style="color: var(--dw-dark);">âœ¨ AI ë¹„ì„œì‹¤ & ê³µìœ ë°©</h2>
                        <p class="text-gray-600">ì•„ì´ë””ì–´ë¥¼ ìƒì„±í•˜ê³  ë™ìƒê³¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µìœ í•˜ì„¸ìš”. (í´ë¼ìš°ë“œ ì €ì¥)</p>
                    </div>
                    <div class="text-4xl">ğŸ¤</div>
                </div>
                
                <!-- API Key UI -->
                <div id="api-key-container" class="mt-6 p-6 bg-orange-50 border border-orange-200 rounded-lg">
                     <div class="flex justify-between items-center mb-4">
                        <label class="block text-lg font-bold text-gray-800">ğŸ”‘ AI API í‚¤ ì„¤ì •</label>
                     </div>
                     <div id="key-input-area">
                         <p class="text-sm text-gray-600 mb-2">API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ë¸Œë¼ìš°ì €ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
                         <div class="flex gap-2">
                            <input type="password" id="manual-api-key" class="flex-grow p-3 border rounded shadow-inner" placeholder="AIzaSy..." onchange="saveApiKey()">
                            <button onclick="saveApiKey()" class="px-6 py-2 bg-gray-800 text-white rounded font-bold hover:bg-gray-700 shadow-md transition">ì €ì¥</button>
                         </div>
                     </div>
                     <div id="key-saved-area" class="hidden">
                        <div class="flex items-center gap-2 mb-2"><span class="text-green-600 font-bold">âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</span></div>
                        <div class="flex gap-2 items-center">
                            <div class="bg-gray-200 text-gray-500 px-4 py-2 rounded flex-grow font-mono text-sm">AIzaSy...******************</div>
                            <button onclick="deleteApiKey()" class="px-4 py-2 bg-red-500 text-white rounded font-bold hover:bg-red-600 shadow-md transition">ì‚­ì œ</button>
                        </div>
                     </div>
                </div>
            </div>

            <!-- Identity Selector -->
            <div class="flex justify-end items-center gap-2">
                <span class="text-sm font-bold text-gray-700">ì‘ì„±ì ì„ íƒ:</span>
                <select id="writer-select" class="p-2 border rounded border-gray-300 text-sm">
                    <option value="ë‚˜ (í˜•/ëˆ„ë‚˜)">ğŸ™‹ ë‚˜ (í˜•/ëˆ„ë‚˜)</option>
                    <option value="ë™ìƒ">ğŸ™‡ ë™ìƒ</option>
                </select>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Tool 1: Scenario -->
                <div class="card p-6 border-t-4" style="border-color: var(--dw-point);">
                    <h3 class="text-xl font-bold mb-4 flex items-center" style="color: var(--dw-dark);">
                        <span class="mr-2">ğŸ¬</span> AI ì‹œë‚˜ë¦¬ì˜¤ ì‘ê°€
                    </h3>
                    <div class="space-y-4">
                        <textarea id="scenario-input" class="w-full p-3 border rounded-lg focus:ring-2 h-24" style="border-color: var(--dw-sand); --tw-ring-color: var(--dw-camel);" placeholder="ìƒí™© ì…ë ¥ (ì˜ˆ: ë™ì›ì´ê°€ ë…¸íŠ¸ë¶ ìœ„ì—ì„œ ì ë“¬)"></textarea>
                        <button onclick="generateScript()" class="w-full text-white py-3 rounded-lg font-bold hover:opacity-90 transition flex justify-center items-center shadow-md" style="background-color: var(--dw-point);">
                            <span id="scenario-btn-text">âœ¨ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±</span>
                            <div id="scenario-loader" class="loader ml-2 hidden" style="width: 20px; height: 20px; border-width: 2px; border-top-color: white;"></div>
                        </button>
                        <div id="scenario-output" class="hidden mt-4 space-y-4"></div>
                    </div>
                </div>

                <!-- Tool 2: Caption -->
                <div class="card p-6 border-t-4" style="border-color: var(--dw-point);">
                    <h3 class="text-xl font-bold mb-4 flex items-center" style="color: var(--dw-dark);">
                        <span class="mr-2">ğŸ“¸</span> AI ìº¡ì…˜ ìƒì„±ê¸°
                    </h3>
                    <div class="space-y-4">
                        <textarea id="caption-input" class="w-full p-3 border rounded-lg focus:ring-2 h-24" style="border-color: var(--dw-sand); --tw-ring-color: var(--dw-camel);" placeholder="ì‚¬ì§„ ë‚´ìš© ì…ë ¥ (ì˜ˆ: ì‚°ì±… ê°€ìë‹ˆê¹Œ ì£½ì€ ì²™ í•¨)"></textarea>
                        <button onclick="generateCaption()" class="w-full text-white py-3 rounded-lg font-bold hover:opacity-90 transition flex justify-center items-center shadow-md" style="background-color: var(--dw-point);">
                            <span id="caption-btn-text">âœ¨ ìº¡ì…˜ ìƒì„±</span>
                            <div id="caption-loader" class="loader ml-2 hidden" style="width: 20px; height: 20px; border-width: 2px; border-top-color: white;"></div>
                        </button>
                        <div id="caption-output" class="hidden mt-4 space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- Shared Board -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 mt-8 relative">
                <div class="flex flex-col md:flex-row items-center justify-between mb-4">
                    <div class="mb-2 md:mb-0">
                        <h3 class="text-xl font-bold flex items-center" style="color: var(--dw-dark);">
                            <span class="mr-2">ğŸ”¥</span> 2ì¸ìš© ì•„ì´ë””ì–´ ê³µìœ ë°©
                        </h3>
                        <span id="connection-status" class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-full">â— ì—°ê²° í™•ì¸ ì¤‘...</span>
                    </div>
                    
                    <!-- NEW: Export Button -->
                    <button onclick="downloadCSV()" class="flex items-center text-sm bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition shadow-sm">
                        <span class="mr-2">ğŸ“Š</span> ì—‘ì…€/ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¡œ ë‚´ë³´ë‚´ê¸°
                    </button>
                </div>
                
                <div id="shared-list" class="grid md:grid-cols-2 gap-4">
                    <div class="col-span-2 text-center py-12 text-gray-400">
                        <div class="loader mx-auto mb-2" style="border-color: #eee; border-top-color: var(--dw-point);"></div>
                        ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="text-center py-8 mt-8" style="background-color: var(--dw-dark); color: var(--dw-sand);">
        <div class="container mx-auto px-4">
            <p class="serif-font font-bold text-lg mb-2">ë™ì› íšŒì¥ë‹˜ ì „ëµê¸°íšì‹¤</p>
            <p class="text-xs opacity-70">Double Life Dog Dongwon Project</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Global Config
        const firebaseConfigStr = typeof __firebase_config !== 'undefined' ? __firebase_config : new URLSearchParams(window.location.search).get('__firebase_config');
        const appId = typeof __app_id !== 'undefined' ? __app_id : new URLSearchParams(window.location.search).get('__app_id') || 'default-app';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;

        let db;
        let auth;
        let currentUser = null;
        let isFirebaseAvailable = false;
        let currentIdeasData = []; // Store data for CSV export

        async function initFirebase() {
            const statusEl = document.getElementById('connection-status');
            
            if (!firebaseConfigStr) {
                console.warn("Firebase configuration missing. Switching to Local Mode.");
                statusEl.textContent = "ğŸŸ  ë¡œì»¬ ì €ì¥ ëª¨ë“œ (ê¸°ê¸° ë‚´ ì €ì¥)";
                statusEl.className = "text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full";
                renderSharedListFromLocal(); // Load local data immediately
                return;
            }

            try {
                const app = initializeApp(JSON.parse(firebaseConfigStr));
                auth = getAuth(app);
                db = getFirestore(app);
                
                // Auth Logic
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Auth Listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        isFirebaseAvailable = true;
                        statusEl.textContent = "ğŸŸ¢ ì‹¤ì‹œê°„ ì—°ë™ ì¤‘ (ë™ìƒê³¼ ê³µìœ  ê°€ëŠ¥)";
                        statusEl.className = "text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full animate-pulse";
                        subscribeToIdeas();
                    } else {
                        // Auth lost, fallback
                        currentUser = null;
                        isFirebaseAvailable = false;
                        statusEl.textContent = "ğŸŸ  ë¡œì»¬ ì €ì¥ ëª¨ë“œ (ì—°ê²° ëŠê¹€)";
                        renderSharedListFromLocal();
                    }
                });

            } catch (e) {
                console.error("Firebase init failed:", e);
                statusEl.textContent = "ğŸŸ  ë¡œì»¬ ì €ì¥ ëª¨ë“œ (ì„¤ì • ì˜¤ë¥˜)";
                statusEl.className = "text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full";
                renderSharedListFromLocal();
            }
        }

        // Initialize Firebase
        initFirebase();

        // --- Shared Idea Functions attached to Window ---
        
        window.saveIdea = async (data, type) => {
            const writer = document.getElementById('writer-select').value;
            const newItem = {
                type: type,
                data: data,
                writer: writer,
                createdAt: new Date().toISOString()
            };

            // CASE 1: Firebase Available
            if (isFirebaseAvailable && currentUser) {
                const collectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'shared_ideas');
                try {
                    await addDoc(collectionRef, newItem);
                    alert("ì•„ì´ë””ì–´ê°€ ê³µìœ ë°©(í´ë¼ìš°ë“œ)ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
                } catch (e) {
                    console.error("Cloud save failed, falling back to local:", e);
                    saveLocal(newItem); // Fallback
                }
            } 
            // CASE 2: Local Mode
            else {
                saveLocal(newItem);
            }
        };

        function saveLocal(item) {
            const saved = JSON.parse(localStorage.getItem('dw_shared_ideas_local') || '[]');
            // Add ID for local items
            item.id = 'local_' + Date.now();
            saved.push(item);
            localStorage.setItem('dw_shared_ideas_local', JSON.stringify(saved));
            renderSharedListFromLocal();
            alert("ì•„ì´ë””ì–´ê°€ ë³´ê´€í•¨(ë¡œì»¬)ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ì„œë²„ ë¯¸ì—°ë™ ìƒíƒœ)");
        }

        window.deleteIdea = async (id) => {
            if (!confirm("ì •ë§ ì´ ì•„ì´ë””ì–´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            
            // Determine if it's a local ID or Firebase ID
            if (id.startsWith('local_')) {
                const saved = JSON.parse(localStorage.getItem('dw_shared_ideas_local') || '[]');
                const updated = saved.filter(item => item.id !== id);
                localStorage.setItem('dw_shared_ideas_local', JSON.stringify(updated));
                renderSharedListFromLocal();
            } else if (isFirebaseAvailable && currentUser) {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'shared_ideas', id);
                try {
                    await deleteDoc(docRef);
                } catch (e) {
                    alert("ì‚­ì œ ì‹¤íŒ¨: " + e.message);
                }
            } else {
                alert("ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì—°ê²° ìƒíƒœ í™•ì¸ í•„ìš”)");
            }
        };

        // --- Rendering Logic ---

        function renderList(ideas) {
            currentIdeasData = ideas; // Update global data for CSV export
            const listEl = document.getElementById('shared-list');
            
            if (ideas.length === 0) {
                listEl.innerHTML = '<p class="text-gray-500 text-sm col-span-2 text-center py-8">ì•„ì§ ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤. <br>ì²« ì•„ì´ë””ì–´ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>';
                return;
            }

            let html = '';
            ideas.forEach(item => {
                const isScenario = item.type === 'scenario';
                const badgeColor = isScenario ? 'bg-[#C28E5B]' : 'bg-[#C9734E]';
                const typeLabel = isScenario ? 'ì‹œë‚˜ë¦¬ì˜¤' : 'ìº¡ì…˜';
                const dateStr = new Date(item.createdAt).toLocaleDateString();
                const isLocal = item.id.startsWith('local_');
                
                let contentHtml = '';
                if (isScenario) {
                    contentHtml = `
                        <div class="mt-2 font-bold text-gray-800 border-l-4 border-[#3D2B24] pl-2 mb-2">"${item.data.narration ? item.data.narration.substring(0, 40) : ''}..."</div>
                        <div class="text-gray-600 text-xs truncate">ğŸ¬ ${item.data.visual}</div>
                    `;
                } else {
                    contentHtml = `
                        <div class="mt-2 font-bold text-gray-900">${item.data.title}</div>
                        <div class="mt-1 text-gray-600 line-clamp-2 text-xs">${item.data.caption}</div>
                    `;
                }

                html += `
                    <div class="card p-4 text-sm relative group bg-white border ${isLocal ? 'border-orange-200 bg-orange-50' : 'border-gray-100'} hover:border-[#C28E5B] transition shadow-sm">
                        <div class="absolute top-2 right-2 flex gap-2">
                            <span class="text-xs bg-white border border-gray-200 text-gray-600 px-2 py-0.5 rounded font-bold">âœï¸ ${item.writer || 'ìµëª…'}</span>
                            <button onclick="deleteIdea('${item.id}')" class="text-gray-300 hover:text-red-500 font-bold px-1 transition">âœ•</button>
                        </div>
                        <div class="flex items-center gap-2 mb-2 mt-1">
                            <span class="${badgeColor} text-white text-xs px-2 py-0.5 rounded">${typeLabel}</span>
                            <span class="text-gray-400 text-xs">${dateStr}</span>
                            ${isLocal ? '<span class="text-[10px] text-orange-600 border border-orange-200 px-1 rounded">Local</span>' : ''}
                        </div>
                        ${contentHtml}
                    </div>
                `;
            });
            listEl.innerHTML = html;
        }

        // Render Local Data
        function renderSharedListFromLocal() {
            const ideas = JSON.parse(localStorage.getItem('dw_shared_ideas_local') || '[]');
            // Sort local ideas
            ideas.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            renderList(ideas);
        }

        // Subscribe to Firebase Data
        function subscribeToIdeas() {
            const listEl = document.getElementById('shared-list');
            const collectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'shared_ideas');
            
            onSnapshot(collectionRef, (snapshot) => {
                const ideas = [];
                snapshot.forEach((doc) => {
                    ideas.push({ id: doc.id, ...doc.data() });
                });
                
                // Sort
                ideas.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderList(ideas);
            }, (error) => {
                console.warn("Snapshot error (switching to local view):", error);
                const statusEl = document.getElementById('connection-status');
                statusEl.textContent = "ğŸŸ  ë¡œì»¬ ë³´ê¸° ëª¨ë“œ (ì„œë²„ ì—°ê²° ë¶ˆê°€)";
                statusEl.className = "text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full";
                renderSharedListFromLocal();
            });
        }

        // --- CSV Export Logic ---
        window.downloadCSV = () => {
            if (!currentIdeasData || currentIdeasData.length === 0) {
                alert("ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // CSV Header
            let csvContent = "\uFEFF"; // BOM for Excel encoding support
            csvContent += "ë‚ ì§œ,ì‘ì„±ì,ìœ í˜•,ë‚´ìš©1(ì œëª©/ëŒ€ì‚¬),ë‚´ìš©2(ë³¸ë¬¸/ì—°ì¶œ),í•´ì‹œíƒœê·¸/BGM\n";

            currentIdeasData.forEach(item => {
                const date = new Date(item.createdAt).toLocaleDateString();
                const writer = item.writer || 'ìµëª…';
                const type = item.type === 'scenario' ? 'ì‹œë‚˜ë¦¬ì˜¤' : 'ìº¡ì…˜';
                
                let col1 = '', col2 = '', col3 = '';
                
                if (item.type === 'scenario') {
                    col1 = `"${(item.data.narration || '').replace(/"/g, '""')}"`; // Escape quotes
                    col2 = `"${(item.data.visual || '').replace(/"/g, '""')}"`;
                    col3 = `"${(item.data.bgm || '').replace(/"/g, '""')}"`;
                } else {
                    col1 = `"${(item.data.title || '').replace(/"/g, '""')}"`;
                    col2 = `"${(item.data.caption || '').replace(/"/g, '""')}"`;
                    col3 = `"${(item.data.hashtags || '').replace(/"/g, '""')}"`;
                }

                csvContent += `${date},${writer},${type},${col1},${col2},${col3}\n`;
            });

            // Trigger Download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `ë™ì›íšŒì¥ë‹˜_ì•„ì´ë””ì–´_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };
    </script>

    <!-- Vanilla Scripts -->
    <script>
        // Navigation Logic
        function navigateTo(sectionId) {
            const sections = ['section-persona', 'section-production', 'section-scenarios', 'section-strategy', 'section-ai-tools'];
            
            // Hide all sections
            sections.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.classList.add('hidden');
            });
            
            // Show target
            const targetSection = document.getElementById(sectionId);
            if(targetSection) targetSection.classList.remove('hidden');

            // Update Nav Buttons
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
                if(btn.getAttribute('onclick').includes(sectionId)) {
                    btn.classList.add('active');
                }
            });

            if(sectionId === 'section-persona') renderChart();
        }

        // Tab Logic for Scenarios
        function showScenario(num) {
            for(let i=1; i<=3; i++) {
                document.getElementById(`scenario-${i}`).classList.add('hidden');
                document.getElementById(`tab-${i}`).classList.remove('active');
                document.getElementById(`tab-${i}`).classList.remove('border-b-3');
            }
            document.getElementById(`scenario-${num}`).classList.remove('hidden');
            document.getElementById(`tab-${num}`).classList.add('active');
        }

        // Chart.js Implementation
        let personaChart = null;
        function renderChart() {
            if (personaChart) return;
            
            const canvas = document.getElementById('personaChart');
            if(!canvas) return; // Guard against missing element

            const ctx = canvas.getContext('2d');
            const rootStyles = getComputedStyle(document.documentElement);
            const dwDark = rootStyles.getPropertyValue('--dw-dark').trim();
            const dwPoint = rootStyles.getPropertyValue('--dw-point').trim();
            const dwCamel = rootStyles.getPropertyValue('--dw-camel').trim();

            personaChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ì—„ê·¼ì§„', 'ë»”ë»”í•¨', 'ì‹íƒ', 'í™œë™ëŸ‰', 'ë‚˜ì´', 'ê·€ì°®ìŒ'],
                    datasets: [{
                        label: 'ë™ì› íšŒì¥ë‹˜',
                        data: [95, 98, 85, 10, 90, 99], 
                        backgroundColor: 'rgba(194, 142, 91, 0.3)',
                        borderColor: dwCamel, 
                        pointBackgroundColor: dwPoint,
                        pointBorderColor: '#fff',
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(61, 43, 36, 0.1)' },
                            grid: { color: 'rgba(61, 43, 36, 0.1)' },
                            pointLabels: { font: { size: 12, weight: 'bold' }, color: dwDark },
                            ticks: { display: false, backdropColor: 'transparent' }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function copyHashtags() {
            const text = document.getElementById('hashtag-box').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const msg = document.getElementById('copy-msg');
                msg.classList.remove('hidden');
                setTimeout(() => { msg.classList.add('hidden'); }, 2000);
            });
        }

        // Profile Image Logic
        function updateProfileImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const result = e.target.result;
                    document.getElementById('profile-image').src = result;
                    try { localStorage.setItem('dongwon_profile_image', result); } catch (e) { alert('ì´ë¯¸ì§€ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤.'); }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function initProfileImage() {
            const savedImage = localStorage.getItem('dongwon_profile_image');
            if (savedImage) document.getElementById('profile-image').src = savedImage;
        }

        // API Key Logic
        const apiKey = ""; 

        function checkApiKey() {
            const savedKey = localStorage.getItem('gemini_user_api_key');
            if (savedKey) {
                document.getElementById('key-input-area').classList.add('hidden');
                document.getElementById('key-saved-area').classList.remove('hidden');
            } else {
                document.getElementById('key-input-area').classList.remove('hidden');
                document.getElementById('key-saved-area').classList.add('hidden');
            }
        }

        function saveApiKey() {
            const keyInput = document.getElementById('manual-api-key').value.trim();
            if (keyInput) {
                localStorage.setItem('gemini_user_api_key', keyInput);
                alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                checkApiKey();
                document.getElementById('manual-api-key').value = '';
            } else {
                alert('í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        function deleteApiKey() {
            if(confirm('API í‚¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('gemini_user_api_key');
                checkApiKey();
            }
        }

        // Gemini API Logic (JSON Mode)
        async function callGemini(prompt, type) {
            const currentKey = apiKey || localStorage.getItem('gemini_user_api_key');
            
            if (!currentKey) {
                await new Promise(resolve => setTimeout(resolve, 1000));
                if(type === 'scenario') return JSON.stringify({
                    visual: "ì¹¨ëŒ€ì— ëˆ„ì›ŒìˆëŠ” ë™ì›ì´ë¥¼ ìœ„ì—ì„œ ì•„ë˜ë¡œ ì°ìŒ.",
                    narration: "ê¹€ë¹„ì„œ, ì§€ê¸ˆ ëª‡ ì‹œì¸ê°€. í•´ê°€ ì¤‘ì²œì´ì•¼.",
                    bgm: "ìš°ì•„í•œ í´ë˜ì‹ (Vivaldi - Four Seasons)"
                });
                else return JSON.stringify({
                    title: "ì›”ì„¸ ëŒ€ì‹  ê·€ì—¬ì›€ìœ¼ë¡œ í‰ì¹˜ì",
                    caption: "ì†”ì§íˆ ì´ ì •ë„ ì™¸ëª¨ë©´ ìˆ™ë°•ë¹„ ë¬´ë£Œ ì•„ë‹Œê°€?",
                    hashtags: "#ê°œë¥´ì‹  #ë»”ë»”ê²¬ #ë™ì›ì´ì˜ì´ì¤‘ìƒí™œ"
                });
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${currentKey}`;
            const instruction = type === 'scenario' 
                ? "You are a scriptwriter for an 11-year-old cynical dog (Dongwon). He uses old-fashioned, authoritative language (Hao-che). Return ONLY valid JSON with keys: 'visual', 'narration', 'bgm'."
                : "You are an Instagram manager for a cynical 11-year-old dog (Dongwon). Return ONLY valid JSON with keys: 'title', 'caption', 'hashtags'.";

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: instruction }] },
                generationConfig: { responseMimeType: "application/json" }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return null;
            }
        }

        // Generate Functions
        window.generateScript = async () => {
            const input = document.getElementById('scenario-input').value;
            if (!input) return alert("ìƒí™©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            const btnText = document.getElementById('scenario-btn-text');
            const loader = document.getElementById('scenario-loader');
            const outputBox = document.getElementById('scenario-output');

            btnText.innerText = "ìƒì„± ì¤‘...";
            loader.classList.remove('hidden');
            outputBox.classList.add('hidden');

            const result = await callGemini(input, 'scenario');
            
            if(result) {
                try {
                    const data = JSON.parse(result);
                    renderScenarioResult(data);
                    outputBox.classList.remove('hidden');
                } catch(e) {
                    outputBox.innerHTML = `<div class="p-4 text-red-500">ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜: ${e.message}</div>`;
                    outputBox.classList.remove('hidden');
                }
            } else {
                alert("ìƒì„± ì‹¤íŒ¨! API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }

            btnText.innerText = "âœ¨ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±";
            loader.classList.add('hidden');
        }

        window.renderScenarioResult = (data) => {
            const html = `
                <div class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200 shadow-sm">
                    <div class="bg-[#3D2B24] text-white px-4 py-2 font-bold text-sm flex justify-between items-center">
                        <span>ğŸ¬ ìƒì„±ëœ ì‹œë‚˜ë¦¬ì˜¤</span>
                        <button onclick='saveIdea(${JSON.stringify(data).replace(/'/g, "&#39;")}, "scenario")' class="bg-[#C9734E] hover:bg-[#A65C3B] text-white px-3 py-1 rounded text-xs transition">ğŸ’¾ ê³µìœ ë°©ì— ì €ì¥</button>
                    </div>
                    <div class="p-4 space-y-4">
                        <div>
                            <div class="text-xs font-bold text-[#C28E5B] uppercase mb-1">Visual</div>
                            <div class="text-gray-800 bg-white p-3 rounded border border-gray-100 shadow-sm">${data.visual}</div>
                        </div>
                        <div>
                            <div class="text-xs font-bold text-[#C28E5B] uppercase mb-1">Narration</div>
                            <div class="text-gray-800 bg-white p-3 rounded border border-gray-100 shadow-sm border-l-4 border-l-[#3D2B24]">"${data.narration}"</div>
                        </div>
                        <div>
                            <div class="text-xs font-bold text-[#C28E5B] uppercase mb-1">BGM</div>
                            <div class="text-gray-600 italic text-sm">ğŸµ ${data.bgm}</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('scenario-output').innerHTML = html;
        }

        window.generateCaption = async () => {
            const input = document.getElementById('caption-input').value;
            if (!input) return alert("ì‚¬ì§„ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            const btnText = document.getElementById('caption-btn-text');
            const loader = document.getElementById('caption-loader');
            const outputBox = document.getElementById('caption-output');

            btnText.innerText = "ìƒì„± ì¤‘...";
            loader.classList.remove('hidden');
            outputBox.classList.add('hidden');

            const result = await callGemini(input, 'caption');
            
            if(result) {
                try {
                    const data = JSON.parse(result);
                    renderCaptionResult(data);
                    outputBox.classList.remove('hidden');
                } catch(e) { console.error(e); }
            }

            btnText.innerText = "âœ¨ ìº¡ì…˜ ìƒì„±";
            loader.classList.add('hidden');
        }

        window.renderCaptionResult = (data) => {
            const html = `
                <div class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200 shadow-sm">
                    <div class="bg-[#3D2B24] text-white px-4 py-2 font-bold text-sm flex justify-between items-center">
                        <span>ğŸ“± ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜</span>
                        <button onclick='saveIdea(${JSON.stringify(data).replace(/'/g, "&#39;")}, "caption")' class="bg-[#C9734E] hover:bg-[#A65C3B] text-white px-3 py-1 rounded text-xs transition">ğŸ’¾ ê³µìœ ë°©ì— ì €ì¥</button>
                    </div>
                    <div class="p-4 space-y-3">
                        <div class="font-bold text-lg text-gray-900">${data.title}</div>
                        <div class="text-gray-700 whitespace-pre-wrap">${data.caption}</div>
                        <div class="text-blue-600 text-sm break-all">${data.hashtags}</div>
                    </div>
                </div>
            `;
            document.getElementById('caption-output').innerHTML = html;
        }

        // Initialize
        window.onload = function() {
            initProfileImage();
            checkApiKey();
            // Start at Persona tab safely
            navigateTo('section-persona');
        };
    </script>
</body>
</html>
